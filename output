============================= test session starts ==============================
platform darwin -- Python 3.10.11, pytest-7.4.0, pluggy-1.2.0
rootdir: /Users/kirstenhunter/src/astrapyjson
plugins: Faker-19.6.1, anyio-3.6.2
collected 14 items

tests/astrapy/test_collections.py .send: b'POST /api/json/v1/vector HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 51\r\nContent-Type: application/json\r\n\r\n'
send: b'{"createCollection": {"name": "pytest_collection"}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:49 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 19
header: Connection: keep-alive
send: b'POST /api/json/v1/vector HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 45\r\nContent-Type: application/json\r\n\r\n'
send: b'{"createCollection": {"name": "test_schema"}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:51 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 19
header: Connection: keep-alive
send: b'POST /api/json/v1/vector HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 38\r\nContent-Type: application/json\r\n\r\n'
send: b'{"createCollection": {"name": "test"}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:52 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 293
header: Connection: keep-alive
.send: b'POST /api/json/v1/vector HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 23\r\nContent-Type: application/json\r\n\r\n'
send: b'{"findCollections": {}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:52 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 89
header: Connection: keep-alive
.send: b'POST /api/json/v1/vector HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 51\r\nContent-Type: application/json\r\n\r\n'
send: b'{"deleteCollection": {"name": "pytest_collection"}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:54 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 19
header: Connection: keep-alive
send: b'POST /api/json/v1/vector HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 45\r\nContent-Type: application/json\r\n\r\n'
send: b'{"deleteCollection": {"name": "test_schema"}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:55 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 19
header: Connection: keep-alive
.send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 123\r\nContent-Type: application/json\r\n\r\n'
send: b'{"insertOne": {"document": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b", "first_name": "Cliff", "last_name": "Wicklow"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:56 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 67
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 72\r\nContent-Type: application/json\r\n\r\n'
send: b'{"findOne": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:56 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 111
header: Connection: keep-alive
DOCUMENTAFTERINSERT {'document': {'_id': '02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b', 'first_name': 'Cliff', 'last_name': 'Wicklow'}}
.send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 157\r\nContent-Type: application/json\r\n\r\n'
send: b'{"insertMany": {"documents": [{"_id": "hIKgYMme", "first_name": "Dang", "last_name": "Son"}, {"_id": "LmiztkUj", "first_name": "Yep", "last_name": "Boss"}]}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:56 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 50
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 24\r\nContent-Type: application/json\r\n\r\n'
send: b'{"find": {"filter": {}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:57 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 2259
header: Connection: keep-alive
.send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 72\r\nContent-Type: application/json\r\n\r\n'
send: b'{"findOne": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:57 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 111
header: Connection: keep-alive
DOCUMENTBEFORESUBDOC {'document': {'_id': '02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b', 'first_name': 'Cliff', 'last_name': 'Wicklow'}}
CLIFFUUID 02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 151\r\nContent-Type: application/json\r\n\r\n'
send: b'{"updateOne": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}, "update": {"$set": {"addresses.city": "New York", "addresses.state": "NY"}}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:57 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 47
header: Connection: keep-alive
DOCUMENT {'status': {'matchedCount': 1, 'modifiedCount': 1}}
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 72\r\nContent-Type: application/json\r\n\r\n'
send: b'{"findOne": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:57 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 156
header: Connection: keep-alive
DOCUMENTAFTERSUBDOC {'document': {'_id': '02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b', 'first_name': 'Cliff', 'last_name': 'Wicklow', 'addresses': {'city': 'New York', 'state': 'NY'}}}
.send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 70\r\nContent-Type: application/json\r\n\r\n'
send: b'{"insertOne": {"document": {"first_name": "New", "last_name": "Guy"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:58 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 67
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 43\r\nContent-Type: application/json\r\n\r\n'
send: b'{"find": {"filter": {"first_name": "New"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:58 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 1795
header: Connection: keep-alive
.send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 96\r\nContent-Type: application/json\r\n\r\n'
send: b'{"updateOne": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}, "first_name": "Dang"}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:58 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 443
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 69\r\nContent-Type: application/json\r\n\r\n'
send: b'{"find": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:59 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 180
header: Connection: keep-alive
{'data': {'documents': [{'_id': '02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b', 'first_name': 'Cliff', 'last_name': 'Wicklow', 'addresses': {'city': 'New York', 'state': 'NY'}}], 'nextPageState': None}}
.send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 154\r\nContent-Type: application/json\r\n\r\n'
send: b'{"findOneAndReplace": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}, "replacement": {"addresses.work": {"city": "New York", "state": "NY"}}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:59 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 212
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 69\r\nContent-Type: application/json\r\n\r\n'
send: b'{"find": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:26:59 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 180
header: Connection: keep-alive
DOCUMENT:  {'data': {'documents': [{'_id': '02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b', 'first_name': 'Cliff', 'last_name': 'Wicklow', 'addresses': {'city': 'New York', 'state': 'NY'}}], 'nextPageState': None}}
Fsend: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 122\r\nContent-Type: application/json\r\n\r\n'
send: b'{"findOneAndUpdate": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}, "update": {"$unset": {"addresses": ""}}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:00 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 202
header: Connection: keep-alive
SUBDOC RESPONSE
{'data': {'document': {'_id': '02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b', 'first_name': 'Cliff', 'last_name': 'Wicklow', 'addresses': {'city': 'New York', 'state': 'NY'}}}, 'status': {'matchedCount': 1, 'modifiedCount': 1}}
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 69\r\nContent-Type: application/json\r\n\r\n'
send: b'{"find": {"filter": {"_id": "02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:00 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 135
header: Connection: keep-alive
{'data': {'documents': [{'_id': '02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b', 'first_name': 'Cliff', 'last_name': 'Wicklow'}], 'nextPageState': None}}
.send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 160\r\nContent-Type: application/json\r\n\r\n'
send: b'{"insertOne": {"document": {"_id": "15135b6d-b921-4f52-9924-69f189aa1a70", "first_name": "Cliff-15135b6d-b921-4f52-9924-69f189aa1a70", "last_name": "Wicklow"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:00 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 67
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 159\r\nContent-Type: application/json\r\n\r\n'
send: b'{"insertOne": {"document": {"_id": "b20b242d-0853-4c23-9f69-43c240c4c6f2", "first_name": "Cliff-15135b6d-b921-4f52-9924-69f189aa1a70", "last_name": "Danger"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:01 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 67
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 82\r\nContent-Type: application/json\r\n\r\n'
send: b'{"find": {"filter": {"first_name": "Cliff-15135b6d-b921-4f52-9924-69f189aa1a70"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:01 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 298
header: Connection: keep-alive
DOCCCC
{'data': {'documents': [{'_id': '15135b6d-b921-4f52-9924-69f189aa1a70', 'first_name': 'Cliff-15135b6d-b921-4f52-9924-69f189aa1a70', 'last_name': 'Wicklow'}, {'_id': 'b20b242d-0853-4c23-9f69-43c240c4c6f2', 'first_name': 'Cliff-15135b6d-b921-4f52-9924-69f189aa1a70', 'last_name': 'Danger'}], 'nextPageState': None}}
.send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 160\r\nContent-Type: application/json\r\n\r\n'
send: b'{"insertOne": {"document": {"_id": "01fa5278-72d7-43de-9c36-8bad004e9f1a", "first_name": "Cliff-01fa5278-72d7-43de-9c36-8bad004e9f1a", "last_name": "Wicklow"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:01 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 67
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 159\r\nContent-Type: application/json\r\n\r\n'
send: b'{"insertOne": {"document": {"_id": "f627013b-f625-4c3e-b21d-bb2f5868cd91", "first_name": "Cliff-01fa5278-72d7-43de-9c36-8bad004e9f1a", "last_name": "Danger"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:02 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 67
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 85\r\nContent-Type: application/json\r\n\r\n'
send: b'{"findOne": {"filter": {"first_name": "Cliff-01fa5278-72d7-43de-9c36-8bad004e9f1a"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:02 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 147
header: Connection: keep-alive
send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 58\r\nContent-Type: application/json\r\n\r\n'
send: b'{"findOne": {"filter": {"first_name": "Cliff-Not-There"}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:02 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 26
header: Connection: keep-alive
.send: b'POST /api/json/v1/vector/test HTTP/1.1\r\nHost: a14e103c-d0f0-4e20-bb7c-87d31a9a9110-us-east1.apps.astra.datastax.com\r\nUser-Agent: python-requests/2.31.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\nX-Cassandra-Token: AstraCS:nWWCtFFxSsEpKoOyKxTdBRvX:836716161d4992f0e334013dda929a1b393a22b6a1f4e09ba87b6bc72f8b7981\r\nContent-Length: 188\r\nContent-Type: application/json\r\n\r\n'
send: b'{"insertOne": {"document": {"_id": "3990ea10-d526-44b4-abe8-1ccdbce80cd9", "first_name": "Cliff-3990ea10-d526-44b4-abe8-1ccdbce80cd9", "last_name": "Wicklow", "roles": ["admin", "user"]}}}'
reply: 'HTTP/1.1 200 OK\r\n'
header: Server: nginx/1.21.4
header: Date: Wed, 04 Oct 2023 23:27:02 GMT
header: Content-Type: application/json;charset=UTF-8
header: Content-Length: 67
header: Connection: keep-alive
F

=================================== FAILURES ===================================
____________________________ test_replace_document _____________________________

test_collection = <astrapy.serverless.AstraCollection object at 0x1086507f0>
cliff_uuid = '02feaf8d-b1ff-47d6-82c2-e244c6a2cb1b'

    @pytest.mark.it("replace a document")
    def test_replace_document(test_collection, cliff_uuid):
        test_collection.find_one_and_replace(
            id=cliff_uuid,
            replacement={
                "addresses.work": {
                    "city": "New York",
                    "state": "NY",
                }
            },
        )
        document = test_collection.find(filter={"_id": cliff_uuid})
        print("DOCUMENT: ", document)
        assert document["data"]["documents"] is not None
>       document_2 = test_collection.find(
            filter={"_id": cliff_uuid}, projection={"$addresses.home": 1}
        )
E       TypeError: AstraCollection.find() got an unexpected keyword argument 'projection'

tests/astrapy/test_collections.py:192: TypeError
________________________________ test_functions ________________________________

test_collection = <astrapy.serverless.AstraCollection object at 0x109434d00>

    @pytest.mark.it("should use document functions")
    def test_functions(test_collection):
        user_id = str(uuid.uuid4())
        test_collection.create(
            document={
                "_id": user_id,
                "first_name": f"Cliff-{user_id}",
                "last_name": "Wicklow",
                "roles": ["admin", "user"],
            },
        )
        update = {"$pop": {"roles": 1}}
        options = {"returnDocument": "after"}
    
>       pop_res = test_collection.pop(id=user_id, update=update, options=options)
E       AttributeError: 'AstraCollection' object has no attribute 'pop'

tests/astrapy/test_collections.py:280: AttributeError
=============================== warnings summary ===============================
tests/astrapy/test_collections.py:67
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:67: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should initialize an AstraDB Collections Client")

tests/astrapy/test_collections.py:72
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:72: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should create a collection")

tests/astrapy/test_collections.py:82
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:82: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should get all collections")

tests/astrapy/test_collections.py:88
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:88: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should delete a collection")

tests/astrapy/test_collections.py:96
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:96: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should create a document")

tests/astrapy/test_collections.py:111
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:111: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should create multiple documents")

tests/astrapy/test_collections.py:134
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:134: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should create a subdocument")

tests/astrapy/test_collections.py:153
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:153: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should create a document without an ID")

tests/astrapy/test_collections.py:165
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:165: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should update a document")

tests/astrapy/test_collections.py:178
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:178: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("replace a document")

tests/astrapy/test_collections.py:199
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:199: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should delete a subdocument")

tests/astrapy/test_collections.py:216
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:216: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should find documents")

tests/astrapy/test_collections.py:240
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:240: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should find a single document")

tests/astrapy/test_collections.py:266
  /Users/kirstenhunter/src/astrapyjson/tests/astrapy/test_collections.py:266: PytestUnknownMarkWarning: Unknown pytest.mark.it - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.it("should use document functions")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/astrapy/test_collections.py::test_replace_document - TypeError: ...
FAILED tests/astrapy/test_collections.py::test_functions - AttributeError: 'A...
================== 2 failed, 12 passed, 14 warnings in 15.64s ==================
